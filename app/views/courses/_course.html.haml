.card.shadow
  .card-header
    %i.fa.fa-graduation-cap{"aria-hidden": "true"}
    = link_to course.title, course_path(course)
  - if course.avatar.attached?
    .card-img-top
      = link_to course_path(course) do
        = image_tag course.avatar, alt: "#{course.title} course thumbnail", loading: "lazy", height: "auto", width: "100%"
  .card-footer
    %small= simple_format(course.marketing_description)
  .card-footer
    .text-center
      = enrollment_button(course)
      = review_button(course)
      = certificate_button(course)

  .card-footer
    .row
      .col-md-6
        %i.text-warning.fa.fa-star{"aria-hidden": "true"}
        %b= course.average_rating
        (
        %i.fa.fa-user-graduate{"aria-hidden": "true"}
        = course.enrollments_count
        )
        %i.fa.fa-tasks{"aria-hidden": "true"}
        = course.lessons_count
      .col-md-6
        .text-end
          - if course.user
            - if course.user.image?
              = image_tag course.user.image, size: '20x20', alt: "#{course.user.email}", class: 'rounded-circle'
            = link_to course.user.username, user_path(course.user)
  - if current_user
    - if policy(course).owner?
      .card-footer
        .text-center
          .btn-group
            = link_to new_course_chapter_path(course, @chapter), class: 'btn btn-sm btn-primary' do
              %i.fa.fa-plus{"aria-hidden": "true"}
              Chapter
            = link_to new_course_lesson_path(course, @lesson), class: 'btn btn-sm btn-primary' do
              %i.fa.fa-plus{"aria-hidden": "true"}
              Lesson
            = link_to course_course_wizard_index_path(course), class: 'btn btn-sm btn-warning' do
              %i.fa.fa-edit{"aria-hidden": "true"}
              Editor
    - if policy(course).admin_or_owner?
      .card-footer
        .btn-group
          = link_to analytics_course_path(course), class: 'btn btn-sm btn-info' do
            %i.fa.fa-chart-bar{"aria-hidden": "true"}
            Analytics
          = link_to new_course_access_grant_path(course), class: 'btn btn-sm btn-success' do
            %i.fa.fa-user-plus{"aria-hidden": "true"}
            Grant Access
      .card-footer
        .form-check.form-switch
          - if course.published?
            %input.form-check-input{id: "published-switch-#{course.id}", :disabled => "disabled", :checked => "checked", :type => "checkbox"}/
          - else
            %input.form-check-input{id: "published-switch-#{course.id}", :disabled => "disabled", :type => "checkbox"}/
          %label.form-check-label{for: "published-switch-#{course.id}"} Teacher Published
        - if policy(course).approve?
          .form-check.form-switch
            = link_to approve_course_path(course), data: { turbo_method: :patch } do
              - if course.approved?
                %input.form-check-input{id: "approved-switch-#{course.id}", :type => "checkbox", :checked => "checked"}/
              - else
                %input.form-check-input{id: "approved-switch-#{course.id}", :type => "checkbox"}/
              %label.form-check-label{for: "approved-switch-#{course.id}"} Admin Approved
        - else
          .form-check.form-switch
            - if course.approved?
              %input.form-check-input{id: "approved-ro-switch-#{course.id}", :disabled => "disabled", :checked => "checked", :type => "checkbox"}/
            - else
              %input.form-check-input{id: "approved-ro-switch-#{course.id}", :disabled => "disabled", :type => "checkbox"}/
            %label.form-check-label{for: "approved-ro-switch-#{course.id}"} Admin Approved
      - if policy(course).destroy?
        .card-footer
          = link_to course, data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }, class: 'btn btn-sm btn-outline-danger' do
            %i.fa.fa-trash{"aria-hidden": "true"}
            Delete
  - if course.tags.any?
    .card-footer
      - course.tags.each do |tag|
        .badge.text-bg-info
          = tag.name
