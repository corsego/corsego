- content_for :title do
  Corsego
  |
  = controller_name.humanize
  = action_name.humanize
- set_meta_tags(robots: "noindex, nofollow")

%h3
  .text-center
    %i.fa.fa-lock-open{"aria-hidden": "true"}
    = controller_name.humanize + ":"
    = action_name.humanize
    .badge.text-bg-info
      = @enrollments.count

= search_form_for @q, url: @ransack_path, html: { class: 'd-flex flex-wrap gap-2 align-items-end' } do |f|
  = f.search_field :user_email_cont, placeholder: 'user email', class: 'form-control form-control-sm'
  = f.search_field :course_title_cont, placeholder: 'course title', class: 'form-control form-control-sm'
  = f.search_field :course_user_email_cont, placeholder: 'teacher', class: 'form-control form-control-sm'
  = f.search_field :price_eq, placeholder: 'price', class: 'form-control form-control-sm'
  = f.search_field :rating_eq, placeholder: 'rating', class: 'form-control form-control-sm'
  = f.submit class: 'btn btn-sm btn-primary'
  = link_to 'refresh', @ransack_path, class: 'btn btn-sm btn-secondary'

.table-responsive.mt-3
  %table.table.table-bordered.table-striped.table-sm.table-hover.bg-white
    %thead
      %tr
        %th ID
        %th
          = sort_link(@q, :user_email, "User")
        %th
          = sort_link(@q, :created_at)
        %th
          = sort_link(@q, :course_title, "Course")
        %th Teacher
        %th
          = sort_link(@q, :price)
        %th
          %i.text-warning.fa.fa-clock{"aria-hidden": "true"}
          = sort_link(@q, :updated_at, 'Reviewed')
        %th
          %i.text-warning.fa.fa-star{"aria-hidden": "true"}
          = sort_link(@q, :rating)
        %th
          %i.text-warning.fa.fa-comment{"aria-hidden": "true"}
          Review
        %th
          = sort_link(@q, :completion_percentage, "Progress")
        %th Certificate
        %th
        %th
        %th

    %tbody
      - @enrollments.each do |enrollment|
        %tr
          %td= enrollment.id
          %td
            - if enrollment.user.present?
              = link_to enrollment.user.email, user_path(enrollment.user)
          %td= enrollment.created_at.strftime("%d/%m/%Y, %H:%M")
          %td= link_to enrollment.course, course_path(enrollment.course)
          %td= link_to enrollment.course.user, user_path(enrollment.course.user)
          %td= number_to_currency(enrollment.price)
          %td
            - if enrollment.rating.present?
              = enrollment.updated_at.strftime("%d/%m/%Y, %H:%M")
          %td= enrollment.rating
          %td= enrollment.review
          %td= number_to_percentage(enrollment.completion_percentage, precision: 0)
          %td= link_to 'PDF', certificate_enrollment_path(enrollment, format: :pdf)
          %td= link_to 'See Review', enrollment
          %td
            - if policy(enrollment).edit?
              = link_to 'Add Review', edit_enrollment_path(enrollment)
          %td
            - if policy(enrollment).destroy?
              = link_to 'Delete Enrollment', enrollment, data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }
!= pagy_bootstrap_nav(@pagy)
